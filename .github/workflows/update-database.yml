name: update database
on:
  push:
    branches:
      - develop
      - staging
      - master

jobs:
  prepare:
    runs-on: self-hosted
    container: ubuntu:22.10
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Install doppler
        run: |
          apt-get update
          apt-get install -y curl gnupg
          curl -Ls --tlsv1.2 --proto "=https" --retry 3 https://cli.doppler.com/install.sh | sh
          chmod +x generate_liquibase_properties.sh
      - name: Generate Files
        env:
          DOPPLER_TOKEN: ${{ secrets.DOPPLER_TOKEN }}
        run: |
          echo ${{ secrets }}
          echo 'doppler ->' $DOPPLER_TOKEN
          doppler secrets download --no-file --format env > .env
          source ./.env
          export $(cut -d= -f1 .env)
          ./generate_liquibase_properties.sh

